<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>cloudJane&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="cloudJane&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="cloudJane&#39;s blog">
<meta property="og:locale" content="zh">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="cloudJane&#39;s blog">
  
    <link rel="alternate" href="/atom.xml" title="cloudJane&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">cloudJane&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-4.redis维护篇 " class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/10/4.redis维护篇 /" class="article-date">
  <time datetime="2019-09-10T06:06:52.212Z" itemprop="datePublished">2019-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="redis维护篇"><a href="#redis维护篇" class="headerlink" title="redis维护篇"></a>redis维护篇</h1><h2 id="启动redis服务"><a href="#启动redis服务" class="headerlink" title="启动redis服务"></a>启动redis服务</h2><p>以下操作使用redis用户操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/redis/standalone</span><br><span class="line"><span class="comment">#指定redis配置文件</span></span><br><span class="line">redis-server redis.conf</span><br></pre></td></tr></table></figure>

<p>查看进程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[redis@zwb-redhat-6 standalone]$ ps -ef|grep redis-server</span><br><span class="line">redis     2721     1  0 10:18 ?        00:00:00 redis-server 192.168.88.135:6379</span><br><span class="line">redis     2726  2657  0 10:18 pts/1    00:00:00 grep redis-server</span><br></pre></td></tr></table></figure>

<h2 id="停止redis服务"><a href="#停止redis服务" class="headerlink" title="停止redis服务"></a>停止redis服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep redis-server</span><br><span class="line"><span class="built_in">kill</span> -9 进程号</span><br></pre></td></tr></table></figure>

<h2 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[redis@zwb-redhat-6 standalone]$ redis-cli -h 192.168.88.135 -p 6379</span><br><span class="line"><span class="comment">#存值</span></span><br><span class="line">192.168.88.135:6379&gt; <span class="built_in">set</span> cust_no 123</span><br><span class="line">OK</span><br><span class="line"><span class="comment">#获取值</span></span><br><span class="line">192.168.88.135:6379&gt; get cust_no</span><br><span class="line"><span class="string">"123"</span></span><br><span class="line">192.168.88.135:6379&gt;</span><br></pre></td></tr></table></figure>

<p>注意：集群中客户端在连接时需要添加-c参数，不然会出现如下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[redis@zwb-redhat-6 6680]$ redis-cli -h 192.168.88.135 -p 6379</span><br><span class="line">192.168.88.135:6379&gt; set name a</span><br><span class="line">(error) MOVED 5798 192.168.88.135:6679</span><br></pre></td></tr></table></figure>

<p>添加-c参数解决<code>redis-cli -c -h 192.168.88.135 -p 6379</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[redis@zwb-redhat-6 6680]$ redis-cli -c -h 192.168.88.135 -p 6379</span><br><span class="line">192.168.88.135:6379&gt; set name a</span><br><span class="line">-&gt; Redirected to slot [5798] located at 192.168.88.135:6679</span><br><span class="line">OK</span><br><span class="line">192.168.88.135:6679&gt;</span><br></pre></td></tr></table></figure>

<h2 id="查看redis服务信息"><a href="#查看redis服务信息" class="headerlink" title="查看redis服务信息"></a>查看redis服务信息</h2><p><strong><code>redis-cli -h 192.168.88.135 -p 6379 info</code></strong><br>-h 指定ip地址，<br>-p 指定端口，<br>info命令显示所有的服务信息，<br>可以在info命令后面添加对应的查看项，查询想要的信息，如redis-cli -h 192.168.88.135 -p 6379 info Stats</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">[redis@zwb-redhat-6 standalone]$ redis-cli -h 192.168.88.135 -p 6379 info</span><br><span class="line"><span class="comment"># Server</span></span><br><span class="line">redis_version:3.2.0</span><br><span class="line">redis_git_sha1:00000000</span><br><span class="line">redis_git_dirty:0</span><br><span class="line">redis_build_id:d211d7e3ba2a27e0</span><br><span class="line">redis_mode:standalone</span><br><span class="line">os:Linux 2.6.32-358.el6.x86_64 x86_64</span><br><span class="line">arch_bits:64</span><br><span class="line">multiplexing_api:epoll</span><br><span class="line">gcc_version:4.4.7</span><br><span class="line">process_id:2397</span><br><span class="line">run_id:261219f11ebbf44e2b08a3070ce151754bd73fa5</span><br><span class="line">tcp_port:6379</span><br><span class="line">uptime_in_seconds:50</span><br><span class="line">uptime_in_days:0</span><br><span class="line">hz:10</span><br><span class="line">lru_clock:12039197</span><br><span class="line">executable:/home/redis/standalone/redis-server</span><br><span class="line">config_file:/home/redis/standalone/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Clients</span></span><br><span class="line">connected_clients:1</span><br><span class="line">client_longest_output_list:0</span><br><span class="line">client_biggest_input_buf:0</span><br><span class="line">blocked_clients:0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Memory</span></span><br><span class="line">used_memory:881376</span><br><span class="line">used_memory_human:860.72K</span><br><span class="line">used_memory_rss:2019328</span><br><span class="line">used_memory_rss_human:1.93M</span><br><span class="line">used_memory_peak:881376</span><br><span class="line">used_memory_peak_human:860.72K</span><br><span class="line">total_system_memory:8248168448</span><br><span class="line">total_system_memory_human:7.68G</span><br><span class="line">used_memory_lua:37888</span><br><span class="line">used_memory_lua_human:37.00K</span><br><span class="line">maxmemory:0</span><br><span class="line">maxmemory_human:0B</span><br><span class="line">maxmemory_policy:noeviction</span><br><span class="line">mem_fragmentation_ratio:2.29</span><br><span class="line">mem_allocator:libc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Persistence</span></span><br><span class="line">loading:0</span><br><span class="line">rdb_changes_since_last_save:0</span><br><span class="line">rdb_bgsave_in_progress:0</span><br><span class="line">rdb_last_save_time:1488434155</span><br><span class="line">rdb_last_bgsave_status:ok</span><br><span class="line">rdb_last_bgsave_time_sec:-1</span><br><span class="line">rdb_current_bgsave_time_sec:-1</span><br><span class="line">aof_enabled:0</span><br><span class="line">aof_rewrite_in_progress:0</span><br><span class="line">aof_rewrite_scheduled:0</span><br><span class="line">aof_last_rewrite_time_sec:-1</span><br><span class="line">aof_current_rewrite_time_sec:-1</span><br><span class="line">aof_last_bgrewrite_status:ok</span><br><span class="line">aof_last_write_status:ok</span><br><span class="line"></span><br><span class="line"><span class="comment"># Stats</span></span><br><span class="line">total_connections_received:1</span><br><span class="line">total_commands_processed:0</span><br><span class="line">instantaneous_ops_per_sec:0</span><br><span class="line">total_net_input_bytes:14</span><br><span class="line">total_net_output_bytes:0</span><br><span class="line">instantaneous_input_kbps:0.00</span><br><span class="line">instantaneous_output_kbps:0.00</span><br><span class="line">rejected_connections:0</span><br><span class="line">sync_full:0</span><br><span class="line">sync_partial_ok:0</span><br><span class="line">sync_partial_err:0</span><br><span class="line">expired_keys:0</span><br><span class="line">evicted_keys:0</span><br><span class="line">keyspace_hits:0</span><br><span class="line">keyspace_misses:0</span><br><span class="line">pubsub_channels:0</span><br><span class="line">pubsub_patterns:0</span><br><span class="line">latest_fork_usec:0</span><br><span class="line">migrate_cached_sockets:0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_repl_offset:0</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU</span></span><br><span class="line">used_cpu_sys:0.07</span><br><span class="line">used_cpu_user:0.01</span><br><span class="line">used_cpu_sys_children:0.00</span><br><span class="line">used_cpu_user_children:0.00</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cluster</span></span><br><span class="line">cluster_enabled:0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Keyspace</span></span><br><span class="line">db0:keys=1,expires=0,avg_ttl=0</span><br></pre></td></tr></table></figure>

<h2 id="查看集群信息"><a href="#查看集群信息" class="headerlink" title="查看集群信息"></a>查看集群信息</h2><p><strong><code>redis-cli -h 192.168.88.135 -p 6379 cluster info</code></strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[redis@zwb-redhat-6 cluster]$ redis-cli -h 192.168.88.135 -p 6379 cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_sent:67</span><br><span class="line">cluster_stats_messages_received:62</span><br></pre></td></tr></table></figure>

<h2 id="查看集群中所有节点信息"><a href="#查看集群中所有节点信息" class="headerlink" title="查看集群中所有节点信息"></a>查看集群中所有节点信息</h2><p><strong><code>redis-cli -h 192.168.88.135 -p 6379 cluster nodes</code></strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[redis@zwb-redhat-6 cluster]$ redis-cli -h 192.168.88.135 -p 6379 cluster nodes</span><br><span class="line">73270a1fca101f71d8a7640bf5fd49984c0d2b0c 192.168.88.135:6579 master - 0 1488434856148 3 connected 10923-16383</span><br><span class="line">5a9e0e234db551efc16a8a9df32802592b8ee828 192.168.88.135:6479 master - 0 1488434857155 2 connected 5461-10922</span><br><span class="line">567e3ad44d9740b453ea93f6d4fd25b2d9fd4cfc 192.168.88.135:6380 slave 0a8d5cf22565323e42419663b789ce523a28ce18 0 1488434854137 4 connected</span><br><span class="line">0a8d5cf22565323e42419663b789ce523a28ce18 192.168.88.135:6379 myself,master - 0 0 1 connected 0-5460</span><br><span class="line">c29b43d9b7881bbd7601e3139da525d4ae76e009 192.168.88.135:6580 slave 73270a1fca101f71d8a7640bf5fd49984c0d2b0c 0 1488434855142 6 connected</span><br><span class="line">9d793bf45522e8b14bef5e820cbe4dd9249cc0a2 192.168.88.135:6480 slave 5a9e0e234db551efc16a8a9df32802592b8ee828 0 1488434858163 5 connected</span><br></pre></td></tr></table></figure>

<p>查询的信息中<code>第一列</code>为节点的id，包含master的为主节点，包含slave的从节点，slave节点<code>后面</code>的id为<code>主节点的id</code>。</p>
<h2 id="检查集群节点状态"><a href="#检查集群节点状态" class="headerlink" title="检查集群节点状态"></a>检查集群节点状态</h2><p><strong><code>redis-trib.rb check 192.168.88.135:6379</code></strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[redis@zwb-redhat-6 cluster]$ redis-trib.rb check 192.168.88.135:6379</span><br><span class="line">/usr/<span class="built_in">local</span>/lib/ruby/gems/2.4.0/gems/redis-3.2.1/lib/redis/client.rb:443: warning: constant ::Fixnum is deprecated</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 192.168.88.135:6379)</span><br><span class="line">M: 0a8d5cf22565323e42419663b789ce523a28ce18 192.168.88.135:6379</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 73270a1fca101f71d8a7640bf5fd49984c0d2b0c 192.168.88.135:6579</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 5a9e0e234db551efc16a8a9df32802592b8ee828 192.168.88.135:6479</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 567e3ad44d9740b453ea93f6d4fd25b2d9fd4cfc 192.168.88.135:6380</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 0a8d5cf22565323e42419663b789ce523a28ce18</span><br><span class="line">S: c29b43d9b7881bbd7601e3139da525d4ae76e009 192.168.88.135:6580</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 73270a1fca101f71d8a7640bf5fd49984c0d2b0c</span><br><span class="line">S: 9d793bf45522e8b14bef5e820cbe4dd9249cc0a2 192.168.88.135:6480</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5a9e0e234db551efc16a8a9df32802592b8ee828</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>

<h2 id="集群中添加节点"><a href="#集群中添加节点" class="headerlink" title="集群中添加节点"></a>集群中添加节点</h2><p>新增两个redis节点，节点的端口分别是6679和6680，6679作为主节点，6680作为的6679从节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#此命令中包含两个ip和端口，第一个ip和端口表示是需要新增节点，后面一个表示是集群中任意一个存在的节点</span></span><br><span class="line">redis-trib.rb add-node 192.168.88.135:6679 192.168.88.135:6379</span><br><span class="line">redis-trib.rb add-node --slave --master-id 61f365bff9982ac6f4807c18cdd2bd55917e20c3  192.168.88.135:6680 192.168.88.135:6379</span><br></pre></td></tr></table></figure>

<h2 id="新节点分配槽（sloat）"><a href="#新节点分配槽（sloat）" class="headerlink" title="新节点分配槽（sloat）"></a>新节点分配槽（sloat）</h2><p>给新增的6679的主节点分片槽（sloat），不分片sloat的节点是无法存储数据的。<br>命令<code>redis-trib.rb reshard host:port</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[redis@zwb-redhat-6 6680]$ redis-trib.rb reshard 192.168.88.135:6379</span><br><span class="line">/usr/<span class="built_in">local</span>/lib/ruby/gems/2.4.0/gems/redis-3.2.1/lib/redis/client.rb:443: warning: constant ::Fixnum is deprecated</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 192.168.88.135:6379)</span><br><span class="line">M: 0a8d5cf22565323e42419663b789ce523a28ce18 192.168.88.135:6379</span><br><span class="line">   slots:1365-5460 (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 73270a1fca101f71d8a7640bf5fd49984c0d2b0c 192.168.88.135:6579</span><br><span class="line">   slots:12288-16383 (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 5a9e0e234db551efc16a8a9df32802592b8ee828 192.168.88.135:6479</span><br><span class="line">   slots:6827-10922 (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 85b09b7b184dde7fc3e95069495811bba86ff7a2 192.168.88.135:6680</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 61f365bff9982ac6f4807c18cdd2bd55917e20c3</span><br><span class="line">S: 567e3ad44d9740b453ea93f6d4fd25b2d9fd4cfc 192.168.88.135:6380</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 0a8d5cf22565323e42419663b789ce523a28ce18</span><br><span class="line">M: 61f365bff9982ac6f4807c18cdd2bd55917e20c3 192.168.88.135:6679</span><br><span class="line">   slots:0-1364,5461-6826,10923-12287 (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: c29b43d9b7881bbd7601e3139da525d4ae76e009 192.168.88.135:6580</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 73270a1fca101f71d8a7640bf5fd49984c0d2b0c</span><br><span class="line">S: 9d793bf45522e8b14bef5e820cbe4dd9249cc0a2 192.168.88.135:6480</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5a9e0e234db551efc16a8a9df32802592b8ee828</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line">How many slots <span class="keyword">do</span> you want to move (from 1 to 16384)? 4096		<span class="comment">#输入一个数,这个4096表示迁移多少个slots数</span></span><br><span class="line">What is the receiving node ID? 61f365bff9982ac6f4807c18cdd2bd55917e20c3		<span class="comment">#输入目标节点ID,表示迁移到哪个目标节点</span></span><br><span class="line">Please enter all the <span class="built_in">source</span> node IDs.</span><br><span class="line">  Type <span class="string">'all'</span> to use all the nodes as <span class="built_in">source</span> nodes <span class="keyword">for</span> the <span class="built_in">hash</span> slots.</span><br><span class="line">  Type <span class="string">'done'</span> once you entered all the <span class="built_in">source</span> nodes IDs.</span><br><span class="line">Source node <span class="comment">#1:all			#输入all表示从老的所有节点进行重分配,凑够4096个slots给到新节点，也可以输入主节点的id表示从具体的某个主节点中迁移。</span></span><br><span class="line">Source node <span class="comment">#2:done			#输入done表示开始迁移</span></span><br></pre></td></tr></table></figure>

<h2 id="删除中的节点"><a href="#删除中的节点" class="headerlink" title="删除中的节点"></a>删除中的节点</h2><p>删除6680端口的节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#del-node        host:port node_id</span></span><br><span class="line"><span class="comment">#第一个参数现有节点的ip和端口，第二个参数要删除的节点id</span></span><br><span class="line">redis-trib.rb del-node 192.168.88.135:6379 3168b29f6b5454b0a70338e00e2f52178552a78e</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/09/10/4.redis维护篇 /" data-id="ck0dfodqa00035k7ktd5kud86" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-5.redis项目集成" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/10/5.redis项目集成/" class="article-date">
  <time datetime="2019-09-10T06:06:52.212Z" itemprop="datePublished">2019-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="redis项目集成"><a href="#redis项目集成" class="headerlink" title="redis项目集成"></a>redis项目集成</h1><h2 id="获取示例工程"><a href="#获取示例工程" class="headerlink" title="获取示例工程"></a>获取示例工程</h2><p>请导入公司提供的示例工程<code>spring-session</code>导入到eclipse中</p>
<h2 id="运行示例工程"><a href="#运行示例工程" class="headerlink" title="运行示例工程"></a>运行示例工程</h2><ul>
<li><code>右击工程-&gt;Run As-&gt;Maven build...</code></li>
</ul>
<p><img src="images/1.png" alt="运行工程1"></p>
<ul>
<li>在Goals中输入<code>tomcat7:run</code></li>
</ul>
<p><img src="images/2.png" alt="运行工程2"></p>
<h2 id="打开示例工程"><a href="#打开示例工程" class="headerlink" title="打开示例工程"></a>打开示例工程</h2><p>浏览器中输入如下地址：<br><code>http://localhost:9080/spring-session/redis.html</code></p>
<p><img src="images/3.png" alt="api操作"></p>
<h2 id="工程说明"><a href="#工程说明" class="headerlink" title="工程说明"></a>工程说明</h2><p>本示例工程提供了缓存操作和会话操作</p>
<h3 id="缓存操作"><a href="#缓存操作" class="headerlink" title="缓存操作"></a>缓存操作</h3><p>缓存操作主要有如下3个类型的操作：</p>
<ol>
<li>字符串的存取</li>
<li>列表的存取</li>
<li>hash的存取</li>
</ol>
<p>缓存具体的操作详解本文中api说明</p>
<h3 id="会话操作"><a href="#会话操作" class="headerlink" title="会话操作"></a>会话操作</h3><p>会话操作使用spring-session进行拦截并同步至redis中的，对应用是透明的，原先会话怎么操作还是怎么操作，spring-sessin会将httpsession中信息同步至redis中。</p>
<p>会话具体的操作详解本文中api说明</p>
<h2 id="项目集成配置文件说明"><a href="#项目集成配置文件说明" class="headerlink" title="项目集成配置文件说明"></a>项目集成配置文件说明</h2><h3 id="conf-properties"><a href="#conf-properties" class="headerlink" title="conf.properties"></a>conf.properties</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#会话超时时间，单位秒</span></span><br><span class="line">session.timeout=1200</span><br></pre></td></tr></table></figure>

<h3 id="spring-applicationContext-xml"><a href="#spring-applicationContext-xml" class="headerlink" title="spring/applicationContext.xml"></a>spring/applicationContext.xml</h3><ul>
<li><p>单机模式引入<code>&lt;value&gt;classpath:redis.properties&lt;/value&gt;</code>和<code>&lt;import resource=&quot;spring-redis.xml&quot; /&gt;</code>两个配置文件</p>
</li>
<li><p>集群模式引入<code>&lt;value&gt;classpath:redis-cluster.properties&lt;/value&gt;</code>和<code>&lt;import resource=&quot;spring-redis-cluster.xml&quot; /&gt;</code>两个配置文件，并注释掉单机的配置文件</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">           http://www.springframework.org/schema/beans   http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       "</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 引入基础配置文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:conf.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath:redis.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- &lt;value&gt;classpath:redis-cluster.properties&lt;/value&gt; --&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"spring-redis.xml"</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;import resource="spring-redis-cluster.xml" /&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.com.yitong.component.redis"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><p>web.xml中添加如下配置，添加拦截，不然redis会话会不生效，详细配置文件见项目中web.xml。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSessionRepositoryFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSessionRepositoryFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="API说明"><a href="#API说明" class="headerlink" title="API说明"></a>API说明</h2><p>具体看代码中的注释</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**   </span></span><br><span class="line"><span class="comment"> * Copyright (c) 2016 Shanghai P&amp;C Information Technology Co.,Ltd. All rights reserved.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span>: SessionController.java </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> cn.com.yitong.redis.session.controller </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: redis api 测试</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 章文兵</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@mail</span> zwb@yitong.com.cn </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2016年6月8日 上午10:39:43 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0   </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.com.yitong.redis.session.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.session.Session;</span><br><span class="line"><span class="keyword">import</span> org.springframework.session.SessionRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.com.yitong.core.cache.ICacheService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: SessionController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 会话操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 章文兵</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@mail</span> zwb@yitong.com.cn</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2016年6月8日 上午10:39:43</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/redis"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SessionRepository repository;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="meta">@Qualifier</span>(<span class="string">"redisService"</span>)</span><br><span class="line">	<span class="keyword">private</span> ICacheService cacheService;</span><br><span class="line"></span><br><span class="line">	Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">	Map&lt;String, String&gt; cache = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 字符串设置值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key			字符串的key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value			字符串的value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/set.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">set</span><span class="params">(String key, String value, HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">		logger.info(<span class="string">"seesion id &#123;&#125;"</span>, request.getSession().getId());</span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(key) || StringUtils.isEmpty(value)) &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"1"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"key or value can not empty"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">			rsp.put(<span class="string">"key"</span>, key);</span><br><span class="line">			rsp.put(<span class="string">"value"</span>, value);</span><br><span class="line">			cacheService.set(key, value, <span class="number">100</span>);</span><br><span class="line">			logger.info(<span class="string">"响应报文：&#123;&#125;"</span>, rsp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 字符串获取值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key			字符串的key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/get.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">get</span><span class="params">(String key, HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(key)) &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"1"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"key can not empty"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">			Object value = cacheService.get(key);</span><br><span class="line">			rsp.put(<span class="string">"key"</span>, key);</span><br><span class="line">			rsp.put(<span class="string">"value"</span>, value);</span><br><span class="line">			logger.info(<span class="string">"响应报文：&#123;&#125;"</span>, rsp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * hash设置值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key		hash的key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> field		hash中字段名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value		hash中字段的值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/hset.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">hset</span><span class="params">(String key, String field, String value, HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(key) || StringUtils.isEmpty(field) || StringUtils.isEmpty(value)) &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"1"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"key or field or value can not empty"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">			cacheService.hset(key, field, value);</span><br><span class="line">			rsp.put(<span class="string">"key"</span>, key);</span><br><span class="line">			rsp.put(<span class="string">"field"</span>, field);</span><br><span class="line">			rsp.put(<span class="string">"value"</span>, value);</span><br><span class="line">			logger.info(<span class="string">"响应报文：&#123;&#125;"</span>, rsp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * hash获取值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key		hash的key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> field		hash中的字段名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request	</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/hget.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">hget</span><span class="params">(String key, String field, HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(key)) &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"1"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"key or field can not empty"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">			Object value = cacheService.hget(key, field);</span><br><span class="line">			rsp.put(<span class="string">"key"</span>, key);</span><br><span class="line">			rsp.put(<span class="string">"value"</span>, value);</span><br><span class="line"></span><br><span class="line">			logger.info(<span class="string">"响应报文：&#123;&#125;"</span>, rsp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 列表存值，从头部存入</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/lpush.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">lpush</span><span class="params">(String key, String value, HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(key) || StringUtils.isEmpty(value)) &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"1"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"key or value can not empty"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">			cacheService.lpush(key, value);</span><br><span class="line">			rsp.put(<span class="string">"key"</span>, key);</span><br><span class="line">			rsp.put(<span class="string">"value"</span>, value);</span><br><span class="line">			logger.info(<span class="string">"响应报文：&#123;&#125;"</span>, rsp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 列表存值，从尾部存入</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key		列表key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value		要存入的值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/rpush.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">rpush</span><span class="params">(String key, String value, HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(key) || StringUtils.isEmpty(value)) &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"1"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"key or value can not empty"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">			cacheService.rpush(key, value);</span><br><span class="line">			rsp.put(<span class="string">"key"</span>, key);</span><br><span class="line">			rsp.put(<span class="string">"value"</span>, value);</span><br><span class="line">			logger.info(<span class="string">"响应报文：&#123;&#125;"</span>, rsp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 列表删除，从头部删除</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key		列表key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/lpop.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">lpop</span><span class="params">(String key, HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(key)) &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"1"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"key can not empty"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">			Object value = cacheService.lpop(key);</span><br><span class="line">			rsp.put(<span class="string">"key"</span>, key);</span><br><span class="line">			rsp.put(<span class="string">"value"</span>, value);</span><br><span class="line">			logger.info(<span class="string">"响应报文：&#123;&#125;"</span>, rsp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 列表删除，从尾部删除</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key		列表key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/rpop.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">rpop</span><span class="params">(String key, HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(key)) &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"1"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"key can not empty"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">			Object value = cacheService.rpop(key);</span><br><span class="line">			rsp.put(<span class="string">"key"</span>, key);</span><br><span class="line">			rsp.put(<span class="string">"value"</span>, value);</span><br><span class="line">			logger.info(<span class="string">"响应报文：&#123;&#125;"</span>, rsp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 列表操作，批量获取数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key		列表key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> begin		开始位置</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> end		结束位置</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/lrange.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">lrange</span><span class="params">(String key, <span class="keyword">long</span> begin, <span class="keyword">long</span> end, HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(key)) &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"1"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"key can not empty"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">			rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">			List&lt;Object&gt; list = cacheService.lrange(key, begin, end);</span><br><span class="line">			rsp.put(<span class="string">"key"</span>, key);</span><br><span class="line">			rsp.put(<span class="string">"begin"</span>, begin);</span><br><span class="line">			rsp.put(<span class="string">"end"</span>, end);</span><br><span class="line">			rsp.put(<span class="string">"list"</span>, list);</span><br><span class="line">			logger.info(<span class="string">"响应报文：&#123;&#125;"</span>, rsp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 会话操作-存值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name		属性名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value		属性值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/session/setValue.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">sessionSetValue</span><span class="params">(String name, String value, HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">		HttpSession httpSession = request.getSession();</span><br><span class="line">		logger.info(<span class="string">"seesion id &#123;&#125;"</span>, httpSession.getId());</span><br><span class="line"></span><br><span class="line">		httpSession.setAttribute(name, value);</span><br><span class="line">		rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">		rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">		rsp.put(<span class="string">"name"</span>, name);</span><br><span class="line">		rsp.put(<span class="string">"value"</span>, value);</span><br><span class="line">		rsp.put(<span class="string">"session"</span>, parseSessionValue(httpSession));</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 会话操作-获取值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name			属性名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request		</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/session/getValue.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">sessionGetValue</span><span class="params">(String name, HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">		HttpSession httpSession = request.getSession();</span><br><span class="line">		logger.info(<span class="string">"seesion id &#123;&#125;"</span>, httpSession.getId());</span><br><span class="line">		Object value = httpSession.getAttribute(name);</span><br><span class="line">		rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">		rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">		rsp.put(<span class="string">"name"</span>, name);</span><br><span class="line">		rsp.put(<span class="string">"value"</span>, value);</span><br><span class="line">		rsp.put(<span class="string">"session"</span>, parseSessionValue(httpSession));</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 会话操作-移除属性</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name			属性名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/session/removeValue.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">sessionRemoveValue</span><span class="params">(String name, HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">			HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">		HttpSession httpSession = request.getSession();</span><br><span class="line">		logger.info(<span class="string">"seesion id &#123;&#125;"</span>, httpSession.getId());</span><br><span class="line">		httpSession.removeAttribute(name);</span><br><span class="line">		rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">		rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">		rsp.put(<span class="string">"name"</span>, name);</span><br><span class="line">		rsp.put(<span class="string">"session"</span>, parseSessionValue(httpSession));</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 会话操作-销毁会话</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value = <span class="string">"/session/invalidate.do"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">sessionInvalidate</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		HttpSession session = request.getSession();</span><br><span class="line">		String oldSessionId = session.getId();</span><br><span class="line">		logger.info(<span class="string">"session id:&#123;&#125;"</span>, oldSessionId);</span><br><span class="line">		session.invalidate();</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">		HttpSession newSession=request.getSession();</span><br><span class="line">		String newSessionId=newSession.getId();</span><br><span class="line">		rsp.put(<span class="string">"oldSessionId"</span>, oldSessionId);</span><br><span class="line">		rsp.put(<span class="string">"newSessionId"</span>, newSessionId);</span><br><span class="line">		rsp.put(<span class="string">"status"</span>, <span class="string">"0"</span>);</span><br><span class="line">		rsp.put(<span class="string">"msg"</span>, <span class="string">"success"</span>);</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 将会话中的属性转换为Map对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> httpSession</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">parseSessionValue</span><span class="params">(HttpSession httpSession)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, Object&gt; rsp = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">		Enumeration&lt;String&gt; names = httpSession.getAttributeNames();</span><br><span class="line">		<span class="keyword">while</span> (names.hasMoreElements()) &#123;</span><br><span class="line">			String name = (String) names.nextElement();</span><br><span class="line">			rsp.put(name, httpSession.getAttribute(name));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rsp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/09/10/5.redis项目集成/" data-id="ck0dfodqc00045k7k669fh7ig" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-1.redis快速入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/10/1.redis快速入门/" class="article-date">
  <time datetime="2019-09-10T06:06:52.212Z" itemprop="datePublished">2019-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Redis是一个开源，先进的key-value存储，并用于构建高性能，可扩展的Web应用程序的完美解决方案。<br>Redis从它的许多竞争继承来的三个主要特点：<br>    • Redis数据库完全在内存中，使用磁盘仅用于持久性。<br>    • 相比许多键值数据存储，Redis拥有一套较为丰富的数据类型。<br>    • Redis可以将数据复制到任意数量的从服务器。<br>Redis 优势<br>    • 异常快速：Redis的速度非常快，每秒能执行约11万集合，每秒约81000+条记录。<br>    • 支持丰富的数据类型：Redis支持最大多数开发人员已经知道像列表，集合，有序集合，散列数据类型。这使得它非常容易解决各种各样的问题，因为我们知道哪些问题是可以处理通过它的数据类型更好。<br>    • 操作都是原子性：所有Redis操作是原子的，这保证了如果两个客户端同时访问的Redis服务器将获得更新后的值。<br>    • 多功能实用工具：Redis是一个多实用的工具，可以在多个用例如缓存，消息，队列使用(Redis原生支持发布/订阅)，任何短暂的数据，应用程序，如Web应用程序会话，网页命中计数等。</p>
<h2 id="日常命令"><a href="#日常命令" class="headerlink" title="日常命令"></a>日常命令</h2><p>启动 Redis<br>$redis-server<br>检查Redis是否在工作？``<br>$redis-cli<br>这将打开一个Redis提示，如下图所示：<br>redis 127.0.0.1:6379&gt;<br>上面的提示127.0.0.1是本机的IP地址，6379为Redis服务器运行的端口。现在输入PING命令，如下图所示。<br>redis 127.0.0.1:6379&gt; ping<br>PONG<br>这说明你已经成功地安装Redis在您的机器上。<br>在Ubuntu上安装Redis的桌面管理器<br>在Ubuntu上安装Redis的桌面管理器，只需从 <a href="http://redisdesktop.com/download" target="_blank" rel="noopener">http://redisdesktop.com/download</a> 打开下载软件包并安装它。<br>Redis桌面管理器会给你用户界面来管理Redis的Key和数据。<br>Redis - 数据类型<br>Redis支持5种类型的数据类型，它描述如下的：</p>
<h3 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h3><p>字符串<br>Redis字符串是字节序列。Redis字符串是二进制安全的，这意味着他们有一个已知的长度没有任何特殊字符终止，所以你可以存储任何东西，512兆为上限。<br>例子<br>redis 127.0.0.1:6379&gt; SET name “yiibai”<br>OK<br>redis 127.0.0.1:6379&gt; GET name<br>“yiibai”<br>上面是Redis的set和get命令的例子，Redis名称为yiibai使用的key存储在Redis的字符串值。<br>哈希<br>Redis的哈希是键值对的集合。 Redis的哈希值是字符串字段和字符串值之间的映射，因此它们被用来表示对象<br>例子<br>redis 127.0.0.1:6379&gt; HMSET user:1 username yiibai password yiibai points 200<br>OK<br>redis 127.0.0.1:6379&gt; HGETALL user:1<br>1) “username”<br>2) “yiibai”<br>3) “password”<br>4) “yiibai”<br>5) “points”<br>6) “200”<br>在上面的例子中的哈希数据类型，用于存储其中包含的用户的基本信息用户的对象。这里HMSET，HEGTALL用户命令user:1是键。</p>
<h3 id="列表操作"><a href="#列表操作" class="headerlink" title="列表操作"></a>列表操作</h3><p>列表<br>Redis的列表是简单的字符串列表，排序插入顺序。您可以添加元素到Redis的列表的头部或尾部。<br>例子<br>redis 127.0.0.1:6379&gt; lpush tutoriallist redis<br>(integer) 1<br>redis 127.0.0.1:6379&gt; lpush tutoriallist mongodb<br>(integer) 2<br>redis 127.0.0.1:6379&gt; lpush tutoriallist rabitmq<br>(integer) 3<br>redis 127.0.0.1:6379&gt; lrange tutoriallist 0 10<br>1) “rabitmq”<br>2) “mongodb”<br>3) “redis”<br>列表的最大长度为 232 - 1 元素（4294967295，每个列表中可容纳超过4十亿的元素）。<br>集合<br>Redis的集合是字符串的无序集合。在Redis您可以添加，删除和测试文件是否存在，在成员O（1）的时间复杂度。<br>例子<br>redis 127.0.0.1:6379&gt; sadd tutoriallist redis<br>(integer) 1<br>redis 127.0.0.1:6379&gt; sadd tutoriallist mongodb<br>(integer) 1<br>redis 127.0.0.1:6379&gt; sadd tutoriallist rabitmq<br>(integer) 1<br>redis 127.0.0.1:6379&gt; sadd tutoriallist rabitmq<br>(integer) 0<br>redis 127.0.0.1:6379&gt; smembers tutoriallist<br>1) “rabitmq”<br>2) “mongodb”<br>3) “redis”<br>注意：在上面的例子中rabitmq集合添加加两次，但由于集合元素具有唯一属性。<br>集合中的元素最大数量为 232 - 1 （4294967295，可容纳超过4十亿元素）。<br>有序集合<br>Redis的有序集合类似于Redis的集合，字符串不重复的集合。不同的是，一个有序集合的每个成员用分数，以便采取有序set命令，从最小的到最大的成员分数有关。虽然成员具有唯一性，但分数可能会重复。<br>例子<br>redis 127.0.0.1:6379&gt; zadd tutoriallist 0 redis<br>(integer) 1<br>redis 127.0.0.1:6379&gt; zadd tutoriallist 0 mongodb<br>(integer) 1<br>redis 127.0.0.1:6379&gt; zadd tutoriallist 0 rabitmq<br>(integer) 1<br>redis 127.0.0.1:6379&gt; zadd tutoriallist 0 rabitmq<br>(integer) 0<br>redis 127.0.0.1:6379&gt; ZRANGEBYSCORE tutoriallist 0 1000<br>1) “redis”<br>2) “mongodb”<br>3) “rabitmq”<br>Redis - keys<br>Redis keys命令用于在Redis的管理键。Redis keys命令使用语法如下所示：<br>语法<br>redis 127.0.0.1:6379&gt; COMMAND KEY_NAME<br>例子<br>redis 127.0.0.1:6379&gt; SET yiibai redis<br>OK<br>redis 127.0.0.1:6379&gt; DEL yiibai<br>(integer) 1<br>在上面的例子中DEL是命令，而yiibai是key。如果key被删除，那么输出该命令将是（整数）1，否则它会是（整数）0<br>Redis - Strings<br>Redis strings命令用于在Redis的管理字符串值。Redis strings命令的使用语法，如下所示：<br>语法<br>redis 127.0.0.1:6379&gt; COMMAND KEY_NAME<br>例子<br>redis 127.0.0.1:6379&gt; SET yiibai redis<br>OK<br>redis 127.0.0.1:6379&gt; GET yiibai<br>“redis”<br>在上面的例子SET和GET是命令，而yiibai是key。</p>
<h3 id="哈希操作"><a href="#哈希操作" class="headerlink" title="哈希操作"></a>哈希操作</h3><p>Redis - 哈希<br>Redis的哈希值是字符串字段和字符串值之间的映射，所以他们是代表对象的完美数据类型<br>在Redis的哈希值，最多可存储超过400十亿字段 - 值对。<br>例子<br>redis 127.0.0.1:6379&gt; HMSET yiibai name “redis tutorial” description “redis basic commands for caching” likes 20 visitors 23000<br>OK<br>redis 127.0.0.1:6379&gt; HGETALL yiibai<br>1) “name”<br>2) “redis tutorial”<br>3) “description”<br>4) “redis basic commands for caching”<br>5) “likes”<br>6) “20”<br>7) “visitors”<br>8) “23000”<br>在上面的例子中，已经在哈希命名yiibai的Redis集合名为tutorials（name, description, likes, visitors）<br>Redis - 列表<br>Redis的列表是简单的字符串列表，排序插入顺序。您可以添加Redis元素在列表头部或列表的尾部。<br>列表的最大长度为 232 - 1 个元素（每个列表元素个数超过4294967295）。<br>例子<br>redis 127.0.0.1:6379&gt; LPUSH tutorials redis<br>(integer) 1<br>redis 127.0.0.1:6379&gt; LPUSH tutorials mongodb<br>(integer) 2<br>redis 127.0.0.1:6379&gt; LPUSH tutorials mysql<br>(integer) 3<br>redis 127.0.0.1:6379&gt; LRANGE tutorials 0 10<br>1) “mysql”<br>2) “mongodb”<br>3) “redis”<br>在上述例子中的三个值被插入在redis列表名为LPUSH的命令教程。</p>
<h2 id="集合操作"><a href="#集合操作" class="headerlink" title="集合操作"></a>集合操作</h2><p>Redis - 集合<br>Redis的集合是唯一的字符串的无序集合。集合的唯一性不允许数据的重复的键。<br>在Redis的集合添加，删除和测试文件是否存在成员在O（1）（常数时间不管里面包含的元素集合的数量）。集合的最大长度为 232 - 1 个元素（每集合超过4294967295元素）。<br>例子<br>redis 127.0.0.1:6379&gt; SADD tutorials redis<br>(integer) 1<br>redis 127.0.0.1:6379&gt; SADD tutorials mongodb<br>(integer) 1<br>redis 127.0.0.1:6379&gt; SADD tutorials mysql<br>(integer) 1<br>redis 127.0.0.1:6379&gt; SADD tutorials mysql<br>(integer) 0<br>redis 127.0.0.1:6379&gt; SMEMBERS tutorials<br>1) “mysql”<br>2) “mongodb”<br>3) “redis”<br>在上述例子中的三个值被命令SADD插入redis的集合名称tutorials。<br>Redis有序集<br>Redis的有序集合类似Redis的集合存储在设定值具有唯一性。不同的是，一个有序集合的每个成员用分数，以便采取有序set命令，从最小的到最大的分数有关。<br>在Redis的有序set添加，删除和测试存在成员O（1）（固定时间，无论里面包含集合元素的数量）。列表的最大长度为 232 - 1 个元素（每集合超过4294967295元素）。<br>例子<br>redis 127.0.0.1:6379&gt; ZADD tutorials 1 redis<br>(integer) 1<br>redis 127.0.0.1:6379&gt; ZADD tutorials 2 mongodb<br>(integer) 1<br>redis 127.0.0.1:6379&gt; ZADD tutorials 3 mysql<br>(integer) 1<br>redis 127.0.0.1:6379&gt; ZADD tutorials 3 mysql<br>(integer) 0<br>redis 127.0.0.1:6379&gt; ZADD tutorials 4 mysql<br>(integer) 0<br>redis 127.0.0.1:6379&gt; ZRANGE tutorials 0 10 WITHSCORES<br>1) “redis”<br>2) “1”<br>3) “mongodb”<br>4) “2”<br>5) “mysql”<br>6) “4”<br>在上述例子中的三个值被命令ZADD插入其得分在redis的有序集命名为tutorials。<br>Redis - HyperLogLog<br>Redis的HyperLogLog使用随机化，以提供唯一的元素数目近似的集合只使用一个常数，并且体积小，少量内存的算法。<br>HyperLogLog提供，即使每个使用了非常少量的内存（12千字节），标准误差为集合的基数非常近似，没有限制的条目数，可以指定，除非接近 264个条目。<br>例子<br>下面的示例说明Redis的HyperLogLog工作原理：<br>redis 127.0.0.1:6379&gt; PFADD tutorials “redis”<br>1) (integer) 1<br>redis 127.0.0.1:6379&gt; PFADD tutorials “mongodb”<br>1) (integer) 1<br>redis 127.0.0.1:6379&gt; PFADD tutorials “mysql”<br>1) (integer) 1<br>redis 127.0.0.1:6379&gt; PFCOUNT tutorials<br>(integer) 3</p>
<h2 id="订阅"><a href="#订阅" class="headerlink" title="订阅"></a>订阅</h2><p>Redis - 订阅<br>Redis的订阅实现了邮件系统，发送者（在Redis的术语中被称为发布者）发送的邮件，而接收器（用户）接收它们。由该消息传送的链路被称为通道。<br>在Redis客户端可以订阅任何数目的通道。<br>示例<br>以下举例说明如何发布用户的概念工作。在下面的例子给出一个客户端订阅一个通道名为redisChat<br>redis 127.0.0.1:6379&gt; SUBSCRIBE redisChat<br>Reading messages… (press Ctrl-C to quit)<br>1) “subscribe”<br>2) “redisChat”<br>3) (integer) 1<br>现在，两个客户端都发布在同一个命名通道redisChat消息，并且以上订阅客户端接收消息。<br>redis 127.0.0.1:6379&gt; PUBLISH redisChat “Redis is a great caching technique”<br>(integer) 1<br>redis 127.0.0.1:6379&gt; PUBLISH redisChat “Learn redis by tutorials point”<br>(integer) 1<br>1) “message”<br>2) “redisChat”<br>3) “Redis is a great caching technique”<br>1) “message”<br>2) “redisChat”<br>3) “Learn redis by tutorials point”</p>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>Redis - 事务<br>Redis事务让一组命令在单个步骤执行。事务中有两个属性，说明如下：<br>    • 在一个事务中的所有命令按顺序执行作为单个隔离操作。通过另一个客户端发出的请求在Redis的事务的过程中执行，这是不可能的。<br>    • Redis的事务具有原子性。原子意味着要么所有的命令都执行或都不执行。<br>例子<br>Redis的事务由指令多重发起，然后需要传递在事务，而且整个事务是通过执行命令EXEC执行命令列表。<br>redis 127.0.0.1:6379&gt; MULTI<br>OK<br>List of commands here<br>redis 127.0.0.1:6379&gt; EXEC<br>例子<br>以下举例说明Redis事务如何启动并执行。<br>redis 127.0.0.1:6379&gt; MULTI<br>OK<br>redis 127.0.0.1:6379&gt; SET tutorial redis<br>QUEUED<br>redis 127.0.0.1:6379&gt; GET tutorial<br>QUEUED<br>redis 127.0.0.1:6379&gt; INCR visitors<br>QUEUED<br>redis 127.0.0.1:6379&gt; EXEC<br>1) OK<br>2) “redis”<br>3) (integer) 1</p>
<h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><p>Redis - 脚本<br>Redis脚本使用Lua解释脚本用于评估计算。它内置的Redis，从2.6.0版本开始使用脚本命令 eval。<br>语法<br>eval命令的基本语法如下：<br>redis 127.0.0.1:6379&gt; EVAL script numkeys key [key …] arg [arg …]<br>例子<br>以下举例说明Redis脚本的工作原理：<br>redis 127.0.0.1:6379&gt; EVAL “return {KEYS[1],KEYS[2],ARGV[1],ARGV[2]}” 2 key1 key2 first second<br>1) “key1”<br>2) “key2”<br>3) “first”<br>4) “second”</p>
<h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2><p>Redis - 连接<br>Redis的连接命令基本上都是用于管理与Redis的服务器客户端连接。<br>Example<br>下面的例子说明了一个客户如何通过Redis服务器验证自己，并检查服务器是否正在运行。<br>redis 127.0.0.1:6379&gt; AUTH “password”<br>OK<br>redis 127.0.0.1:6379&gt; PING<br>PONG<br>Redis - 备份<br>Redis SAVE命令用来创建当前的 Redis 数据库备份。<br>语法<br>对Redis SAVE命令的基本语法如下所示：<br>127.0.0.1:6379&gt; SAVE<br>例子<br>下面的示例显示了 Redis 当前数据库如何创建备份。<br>127.0.0.1:6379&gt; SAVE<br>OK<br>这个命令将创建dump.rdb文件在Redis目录中。<br>还原Redis数据<br>要恢复Redis的数据只需移动 Redis 的备份文件（dump.rdb）到 Redis 目录，然后启动服务器。为了得到你的 Redis 目录，使用配置命令如下所示：<br>127.0.0.1:6379&gt; CONFIG get dir<br>1) “dir”<br>2) “/user/yiibai/redis-2.8.13/src”<br>在上述命令的输出在 /user/yiibai/redis-2.8.13/src 目录，在安装redis的服务器安装位置。<br>Bgsave<br>要创建Redis的备份备用命令BGSAVE也可以。这个命令将开始执行备份过程，并在后台运行。<br>例子<br>127.0.0.1:6379&gt; BGSAVE<br>Background saving started</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>Redis - 安全<br>可以Redis的数据库更安全，所以相关的任何客户端都需要在执行命令之前进行身份验证。客户端输入密码匹配需要使用Redis设置在配置文件中的密码。<br>例子<br>下面给出的例子显示的步骤，以确保您的Redis实例安全。<br>127.0.0.1:6379&gt; CONFIG get requirepass<br>1) “requirepass”<br>2) “”<br>默认情况下，此属性为空，表示没有设置密码，此实例。您可以通过执行以下命令来更改这个属性<br>127.0.0.1:6379&gt; CONFIG set requirepass “yiibai”<br>OK<br>127.0.0.1:6379&gt; CONFIG get requirepass<br>1) “requirepass”<br>2) “yiibai”<br>设置密码，如果客户端运行命令没有验证，会提示（错误）NOAUTH，需要通过验证。错误将返回客户端。因此，客户端需要使用AUTHcommand进行认证。<br>语法<br>AUTH命令的基本语法如下所示：<br>127.0.0.1:6379&gt; AUTH password</p>
<h2 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h2><p>Redis - 基准<br>Redis基准是公用工具同时运行Ñ命令检查Redis的性能。<br>语法<br>redis的基准的基本语法如下所示：<br>redis-benchmark [option] [option value]<br>例子<br>下面给出的例子检查redis调用100000命令。<br>redis-benchmark -n 100000<br>PING_INLINE: 141043.72 requests per second<br>PING_BULK: 142857.14 requests per second<br>SET: 141442.72 requests per second<br>GET: 145348.83 requests per second<br>INCR: 137362.64 requests per second<br>LPUSH: 145348.83 requests per second<br>LPOP: 146198.83 requests per second<br>SADD: 146198.83 requests per second<br>SPOP: 149253.73 requests per second<br>LPUSH (needed to benchmark LRANGE): 148588.42 requests per second<br>LRANGE_100 (first 100 elements): 58411.21 requests per second<br>LRANGE_300 (first 300 elements): 21195.42 requests per second<br>LRANGE_500 (first 450 elements): 14539.11 requests per second<br>LRANGE_600 (first 600 elements): 10504.20 requests per second<br>MSET (10 keys): 93283.58 requests per second</p>
<h2 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h2><p>Redis - 客户端连接<br>Redis接受配置监听TCP端口和Unix套接字客户端的连接，如果启用。当一个新的客户端连接被接受以下操作进行：<br>    • 客户端套接字置于非阻塞状态，因为Redis使用复用和非阻塞I/O操作。<br>    • TCP_NODELAY选项设定是为了确保我们没有在连接时延迟。<br>    • 创建一个可读的文件时，这样Redis能够尽快收集客户端的查询作为新的数据可供读取的套接字。<br>客户端的最大数量<br>在Redis的配置（redis.conf）属性调用maxclients，它描述客户端可以连接到Redis的最大数量。命令的基本语法是：<br>config get maxclients<br>1) “maxclients”<br>2) “10000”<br>默认情况下，此属性设置为10000（这取决于操作系统的文件描述符限制最大数量），但你可以改变这个属性。<br>例子<br>在下面给出的例子中，在启动服务器我们设置客户端的最大数量为10万。<br>redis-server –maxclients 100000<br>Redis - 管道传输<br>Redis是一个TCP服务器，并支持请求/响应协议。在redis一个请求完成下面的步骤：<br>    • 客户端发送一个查询到服务器，并从套接字中读取，通常在阻塞的方式，对服务器的响应。<br>    • 服务器处理命令并将响应返回给客户端。<br>管道传输的含义<br>管道的基本含义是，客户端可以发送多个请求给服务器，而无需等待答复所有，并最后读取在单个步骤中的答复。<br>例子<br>要检查redis的管道，只要启动Redis实例，然后在终端键入以下命令。<br>$(echo -en “PING\r\n SET tutorial redis\r\nGET tutorial\r\nINCR visitor\r\nINCR visitor\r\nINCR visitor\r\n”; sleep 10) | nc localhost 6379<br>+PONG<br>+OK<br>redis<br>:1<br>:2<br>:3<br>在上述例子中，我们必须使用PING命令检查Redis的连接，之后，我们已经设定值的Redis字符串命名tutorial ，之后拿到key的值和增量访问量的三倍。在结果中，我们可以检查所有的命令都一次提交给Redis，Redis是在一个步骤给出所有命令的输出。<br>管道的好处<br>这种技术的好处是极大地改善协议的性能。通过管道将慢互联网连接速度从5倍的连接速度提高到localhost至少达到百过倍。</p>
<h2 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h2><p>Redis - 分区<br>分区是一种将数据分成多个Redis的情况下，让每一个实例将只包含你的键字的子集的过程。<br>分区的好处<br>    • 它允许更大的数据库，使用的多台计算机的存储器的总和。如果不分区，一台计算机的内存可支数量有限。<br>    • 它允许以大规模的计算能力，以多个内核和多个计算机，以及网络带宽向多台计算机和网络适配器。<br>分区的缺点<br>    • 通常不支持涉及多个键的操作。例如，不能两个集合之间执行交叉点，因为它们存储在被映射到不同Redis实例中的键。<br>    • 涉及多个键的Redis事务不能被使用。<br>    • 分区粒度是关键，所以它是不可能分片数据集用一个硕大的键是一个非常大的有序集合。<br>    • 当分区时，数据处理比较复杂，比如要处理多个RDB/AOF文件，使数据备份需要从多个实例和主机聚集持久性文件。<br>    • 添加和删除的能力可能很复杂。比如Redis的集群支持有添加，并在运行时删除节点不支持此功能的能力，但其他系统，如客户端的分区和代理的数据大多是透明的重新平衡。但是有一个叫Presharding技术有助于在这方面。<br>分区的类型<br>redis的提供有两种类型的分区。假设我们有四个Redis实例R0，R1，R2，R3和代表用户很多键如：user:1, user:2, … 等等<br>范围分区<br>范围分区被映射对象转化为具体的Redis实例的范围内实现。假定在本例中用户ID0〜ID10000将进入实例R0，而用户形成ID10001至20000号将进入实例R1等等。<br>散列分区<br>在这种类型的分区，一个散列函数（例如，模数函数）被用于转换键成数字，然后数据被存储在不同redis的实例。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/09/10/1.redis快速入门/" data-id="ck0dfodqm00055k7k62vt1l6z" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2.redis安装篇" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/10/2.redis安装篇/" class="article-date">
  <time datetime="2019-09-10T06:06:52.196Z" itemprop="datePublished">2019-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="redis安装篇"><a href="#redis安装篇" class="headerlink" title="redis安装篇"></a>redis安装篇</h1><h2 id="单机安装"><a href="#单机安装" class="headerlink" title="单机安装"></a>单机安装</h2><h3 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h3><ul>
<li>操作系统：redhat6.4</li>
</ul>
<h3 id="获取安装包"><a href="#获取安装包" class="headerlink" title="获取安装包"></a>获取安装包</h3><ol>
<li>从redis官网下载对应的版本，下载地址：<a href="http://download.redis.io/releases/" target="_blank" rel="noopener">http://download.redis.io/releases/</a></li>
<li>从公司获取现成的版本，本次培训使用的redis-3.2.10版本</li>
</ol>
<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>使用yum自动安装依赖的包，请先配置好yum仓库，不然手工安装一个个依赖包会非常浪费时间。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install cpp binutils glibc glibc-kernheaders glibc-common glibc-devel gcc make gcc-c++ libstdc++-devel tcl zlib-devel</span><br></pre></td></tr></table></figure>

<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><p>注意：安装时使用root用户安装，实际生产环境中请新建用户（redis或者cache等）进行管理。</p>
<p>以下使用root用户安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、上传安装包至/opt目录</span></span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line"><span class="comment">#2、解压安装包</span></span><br><span class="line">tar -xzvf redis-3.2.10.tar.gz</span><br><span class="line"><span class="built_in">cd</span> redis-3.2.10</span><br><span class="line"><span class="comment">#3、编译</span></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#4、配置命令</span></span><br><span class="line"><span class="comment">#copy src目录如下文件到/usr/local/bin目录，方便直接使用这些命令</span></span><br><span class="line"><span class="built_in">cd</span> src</span><br><span class="line">cp redis-server /usr/<span class="built_in">local</span>/bin</span><br><span class="line">cp redis-sentinel /usr/<span class="built_in">local</span>/bin</span><br><span class="line">cp redis-cli /usr/<span class="built_in">local</span>/bin</span><br><span class="line">cp redis-benchmark /usr/<span class="built_in">local</span>/bin</span><br><span class="line">cp redis-check-aof /usr/<span class="built_in">local</span>/bin</span><br><span class="line">cp redis-trib.rb /usr/<span class="built_in">local</span>/bin</span><br></pre></td></tr></table></figure>

<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><h4 id="新建redis管理用户"><a href="#新建redis管理用户" class="headerlink" title="新建redis管理用户"></a>新建redis管理用户</h4><p>本文档使用redis用户管理redis服务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新建用户</span></span><br><span class="line">useradd -d /home/redis -m redis</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改密码</span></span><br><span class="line">passwd redis</span><br></pre></td></tr></table></figure>

<h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>以下操作使用redis用户操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新建配置文件目录</span></span><br><span class="line">mkdir -p /home/redis/standalone</span><br><span class="line"></span><br><span class="line"><span class="comment">#拷贝配置文件</span></span><br><span class="line">cp /opt/redis-3.2.10/redis.conf /home/redis/standalone</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">vi /home/redis/standalone/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改如下配置：</span></span><br><span class="line"><span class="comment">#端口号</span></span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改默认绑定ip，修改为自己服务器的ip，不然客户端使用ip地址是无法访问的</span></span><br><span class="line"><span class="built_in">bind</span> 192.168.88.135</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份文件目录</span></span><br><span class="line">dir /home/redis/standalone/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改如下redis.conf文件</span></span><br><span class="line"> 默认为no，此配置表示后台启动</span><br><span class="line"> daemonize yes</span><br><span class="line"></span><br><span class="line"> <span class="comment">#修改进程号文件，以端口号区分</span></span><br><span class="line"> pidfile /home/redis/standalone/redis.pid</span><br><span class="line"></span><br><span class="line"> <span class="comment">#修改日志文件路径</span></span><br><span class="line"> logfile <span class="string">"/home/redis/standalone/redis.log"</span></span><br></pre></td></tr></table></figure>

<h4 id="启动redis服务"><a href="#启动redis服务" class="headerlink" title="启动redis服务"></a>启动redis服务</h4><p>以下操作使用redis用户操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/redis/standalone</span><br><span class="line"><span class="comment">#指定redis配置文件</span></span><br><span class="line">redis-server redis.conf</span><br></pre></td></tr></table></figure>

<p>查看进程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[redis@zwb-redhat-6 standalone]$ ps -ef|grep redis-server</span><br><span class="line">redis     2721     1  0 10:18 ?        00:00:00 redis-server 192.168.88.135:6379</span><br><span class="line">redis     2726  2657  0 10:18 pts/1    00:00:00 grep redis-server</span><br></pre></td></tr></table></figure>

<h4 id="停止redis服务"><a href="#停止redis服务" class="headerlink" title="停止redis服务"></a>停止redis服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -9 进程号</span><br></pre></td></tr></table></figure>

<h4 id="客户端端测试"><a href="#客户端端测试" class="headerlink" title="客户端端测试"></a>客户端端测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[redis@zwb-redhat-6 standalone]$ redis-cli -h 192.168.88.135 -p 6379</span><br><span class="line"><span class="comment">#存值</span></span><br><span class="line">192.168.88.135:6379&gt; <span class="built_in">set</span> cust_no 123</span><br><span class="line">OK</span><br><span class="line"><span class="comment">#获取值</span></span><br><span class="line">192.168.88.135:6379&gt; get cust_no</span><br><span class="line"><span class="string">"123"</span></span><br><span class="line">192.168.88.135:6379&gt;</span><br></pre></td></tr></table></figure>

<h2 id="集群安装"><a href="#集群安装" class="headerlink" title="集群安装"></a>集群安装</h2><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><ul>
<li>集群安装需要redis3.0+的版本支持</li>
<li>完成单机安装</li>
<li>redis3.0集群需要ruby环境支持，需要安装ruby环境</li>
</ul>
<h3 id="安装ruby"><a href="#安装ruby" class="headerlink" title="安装ruby"></a>安装ruby</h3><p>使用root用户安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#上传ruby-2.4.0.tar.gz安装包至/opt目录</span></span><br><span class="line"><span class="comment">#安装ruby</span></span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">tar -xzvf ruby-2.4.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> ruby-2.4.0</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#上传redis-3.2.10.gem至/opt目录</span></span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">gem install --<span class="built_in">local</span> redis-3.3.2.gem</span><br></pre></td></tr></table></figure>

<h3 id="修改配置文件-1"><a href="#修改配置文件-1" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新建配置文件目录</span></span><br><span class="line">mkdir -p /home/redis/cluster/6379</span><br><span class="line"><span class="comment">#拷贝单机的配置文件</span></span><br><span class="line">cp /home/redis/standalone/redis.conf /home/redis/cluster/6379</span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#端口号</span></span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改默认绑定ip，修改为自己服务器的ip，不然客户端使用ip地址是无法访问的</span></span><br><span class="line"><span class="built_in">bind</span> 192.168.88.135</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改如下，默认为no，此配置表示后台启动</span></span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份文件目录</span></span><br><span class="line">dir /home/redis/cluster/6379/</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改进程号文件，以端口号区分</span></span><br><span class="line">pidfile /home/redis/cluster/6379/redis.pid</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改日志文件路径</span></span><br><span class="line">logfile <span class="string">"/home/redis/cluster/6379/redis.log"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#开启集群</span></span><br><span class="line">cluster-enabled yes</span><br><span class="line"><span class="comment">#指定集群的配置文件</span></span><br><span class="line">cluster-config-file <span class="string">"/home/redis/cluster/6379/nodes.conf"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#集群中节点挂了，不影响整个集群，可以正常访问其他节点的数据</span></span><br><span class="line">cluster-require-full-coverage no</span><br></pre></td></tr></table></figure>

<h3 id="集群中其他节点安装"><a href="#集群中其他节点安装" class="headerlink" title="集群中其他节点安装"></a>集群中其他节点安装</h3><p>集群中其他节点安装，参考以上的安装步骤，修改对应配置文件路径和端口即可</p>
<h3 id="集群启动脚本"><a href="#集群启动脚本" class="headerlink" title="集群启动脚本"></a>集群启动脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> [`date`]开始启动redis集群...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">startRedis</span></span>()&#123;</span><br><span class="line">port=<span class="variable">$1</span></span><br><span class="line">cmd=<span class="string">"redis-server /home/redis/cluster/<span class="variable">$&#123;port&#125;</span>/redis.conf"</span></span><br><span class="line"><span class="built_in">echo</span> [`date`]<span class="variable">$&#123;cmd&#125;</span></span><br><span class="line">`<span class="variable">$&#123;cmd&#125;</span>`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">startRedis 6379</span><br><span class="line">startRedis 6479</span><br><span class="line">startRedis 6579</span><br><span class="line">startRedis 6380</span><br><span class="line">startRedis 6480</span><br><span class="line">startRedis 6580</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> [`date`]redis集群启动完成!</span><br></pre></td></tr></table></figure>

<h3 id="创建集群"><a href="#创建集群" class="headerlink" title="创建集群"></a>创建集群</h3><p>使用启动脚本，启动本机上的所以redis节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-trib.rb create --replicas 1 192.168.88.135:6379 192.168.88.135:6479 192.168.88.135:6579 192.168.88.135:6380 192.168.88.135:6480 192.168.88.135:6580</span><br><span class="line"></span><br><span class="line"><span class="comment">#--replicas 1：指定了master从库的数量为1，前面3个ip和端口表示是主服务，后面3个表示是从服务</span></span><br></pre></td></tr></table></figure>

<h2 id="安装问题汇总"><a href="#安装问题汇总" class="headerlink" title="安装问题汇总"></a>安装问题汇总</h2><h3 id="make编译时出现错误"><a href="#make编译时出现错误" class="headerlink" title="make编译时出现错误"></a>make编译时出现错误</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zmalloc.h:50:31: 错误：jemalloc/jemalloc.h：没有那个文件或目录</span><br><span class="line">在部署redis出现如题所述问题</span><br></pre></td></tr></table></figure>

<p>解决方法:编译时使用如下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make MALLOC=libc</span><br></pre></td></tr></table></figure>

<h3 id="cannot-load-such-file-–-zlib"><a href="#cannot-load-such-file-–-zlib" class="headerlink" title="cannot load such file – zlib"></a>cannot load such file – zlib</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zwb-redhat-6 opt]# gem install redis-3.2.gem</span><br><span class="line">ERROR:  Loading command: install (LoadError)</span><br><span class="line">	cannot load such file -- zlib</span><br><span class="line">ERROR:  While executing gem ... (NoMethodError)</span><br><span class="line">    undefined method `invoke_with_build_args&apos; for nil:NilClass</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install zlib-devel</span><br><span class="line"><span class="built_in">cd</span>   ruby安装目录/ext/zlib</span><br><span class="line">ruby extconf.rb</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/09/10/2.redis安装篇/" data-id="ck0dfodpt00005k7khlpdkyp8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-3.redis调优篇" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/10/3.redis调优篇/" class="article-date">
  <time datetime="2019-09-10T06:06:52.196Z" itemprop="datePublished">2019-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="redis调优篇"><a href="#redis调优篇" class="headerlink" title="redis调优篇"></a>redis调优篇</h1><h2 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h2><h3 id="开启TCP连接快速回收"><a href="#开启TCP连接快速回收" class="headerlink" title="开启TCP连接快速回收"></a>开启TCP连接快速回收</h3><p>开启TCP连接中TIME-WAIT sockets的快速回收，有助于快速释放TCP连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">修改/etc/sysctl.conf文件</span><br><span class="line"></span><br><span class="line">修改下面的参数，如果没有请新增此参数</span><br><span class="line">net.ipv4.tcp_tw_recycle=1</span><br></pre></td></tr></table></figure>

<p>使用<code>sysctl -p</code>使配置生效，重启后配置依然有效。</p>
<h3 id="修改open-files参数"><a href="#修改open-files参数" class="headerlink" title="修改open files参数"></a>修改open files参数</h3><p>修改open files，默认open files的值为<code>1024</code>，太小了，有些程序使用的句柄数过多就会报系统异常了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#临时生效，重启后，参数又会被还原</span></span><br><span class="line"><span class="built_in">ulimit</span> -n 65536</span><br><span class="line"></span><br><span class="line"><span class="comment">#永久生效</span></span><br><span class="line"><span class="comment">#修改/etc/security/limits.conf文件</span></span><br><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 65536</span><br></pre></td></tr></table></figure>

<p>注意：<strong>重启服务器此参数才能生效</strong>。</p>
<h3 id="其他参数修改"><a href="#其他参数修改" class="headerlink" title="其他参数修改"></a>其他参数修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#临时生效，如下参数修改都是临时生效的，重启后，参数又会被还原</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/vm/overcommit_memory</span><br><span class="line"><span class="built_in">echo</span> 8192 &gt; /proc/sys/net/core/somaxconn</span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#永久修改方法</span></span><br><span class="line"><span class="comment">#修改vi /etc/rc.local</span></span><br><span class="line"><span class="comment">#添加如下内容：</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/vm/overcommit_memory</span><br><span class="line"><span class="built_in">echo</span> 8192 &gt; /proc/sys/net/core/somaxconn</span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/09/10/3.redis调优篇/" data-id="ck0dfodpz00015k7klso8qvep" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/10/hello-world/" class="article-date">
  <time datetime="2019-09-10T04:00:47.661Z" itemprop="datePublished">2019-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/10/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/09/10/hello-world/" data-id="ck0dfodq900025k7kdiykd5v9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/09/10/4.redis维护篇 /">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/09/10/5.redis项目集成/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/09/10/1.redis快速入门/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/09/10/2.redis安装篇/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/09/10/3.redis调优篇/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>